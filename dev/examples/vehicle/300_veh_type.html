
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Vehicle Choice Mixed Logit &#8212; v6.0.26.dev2+g135c0b8</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=9d77a3fd" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=c73c0f3e"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/vehicle/300_veh_type';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://raw.githubusercontent.com/driftlesslabs/larch/docs/docs/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '6.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../../_static/larch_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Vehicle Choice Examples" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search these docs..."
         aria-label="Search these docs..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/larch-logo.png" class="logo__image only-light" alt="v6.0.26.dev2+g135c0b8 - Home"/>
    <script>document.write(`<img src="../../_static/larch-logo.png" class="logo__image only-dark" alt="v6.0.26.dev2+g135c0b8 - Home"/>`);</script>
  
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api/index.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Examples
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../user-guide/index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api/index.html">
    API
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Examples
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../mtc/index.html">MTC Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../mtc/001_mnl.html">1: MTC MNL Mode Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/002_motorized.html">2: Income Effect on Motorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/003_zeroed_shared.html">3: Income Effect only on Non-Car</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/005_motorized_travel_time.html">5: Motorized Travel Time</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/006_motorized_times.html">6: Motorized IVTT and OVTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/007_ovtt_by_distance.html">7: Diminishing OVTT by Distance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/008_ttr.html">8: Constrained Travel Time Ratio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/009_ttr_4.html">9: Travel Time Ratio of 4.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/010_auto_per_hh.html">10: Number of Automobiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/011_veh_per_worker.html">11: Vehicles per Worker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/012_autos_per_adult.html">12: Vehicles per Adult</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/013_cbd.html">13: Destination in CBD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/014_work_zone_density.html">14: Work Zone Density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/015_cbd_and_work_density.html">15: CBD and Work Zone Density</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/016_cost_by_income.html">16: Cost by Income</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/017A_market_seg.html">17A: Market Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/017B_alt_segmentation.html">17B: Alternative Segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/017C_segmentation_males.html">17C: Gender Segmentation (Male)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/017D_segmentation_female.html">17D: Gender Segmentation (Female)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/017_mnl.html">17: MTC Expanded MNL Mode Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/022_nl.html">22: MTC Motorized and Non-Motorized Nested Mode Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mtc/030_mnl_constrain.html">30: MTC MNL Constrained Mode Choice</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../swissmetro/index.html">Swissmetro Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../swissmetro/101_swissmetro_mnl.html">101: Swissmetro MNL Mode Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swissmetro/102-swissmetro-weighted.html">102: Swissmetro Weighted MNL Mode Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../swissmetro/109-swissmetro-nl.html">109: Swissmetro Nested Logit Mode Choice</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../exampville/index.html">Exampville Simulator</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../exampville/200_exampville.html">200: Exampville Simulated Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exampville/201_exville_mode_choice.html">201: Exampville Mode Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exampville/202_exville_mc_logsums.html">202: Exampville Mode Choice Logsums</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exampville/203_exville_dest.html">203: Exampville Destination Choice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../exampville/204_exville_dest_only.html">204: Exampville Destination Choice without Logsums</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Vehicle Choice Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Vehicle Choice Mixed Logit</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Examples</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Vehicle Choice Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Vehicle...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="vehicle-choice-mixed-logit">
<h1>Vehicle Choice Mixed Logit<a class="headerlink" href="#vehicle-choice-mixed-logit" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">larch</span> <span class="k">as</span> <span class="nn">lx</span>
<span class="kn">from</span> <span class="nn">larch</span> <span class="kn">import</span> <span class="n">PX</span>
</pre></div>
</div>
</div>
</div>
<p>In this example, we will demonstrate the estimatation of parameters for
mixed logit models.  The examples are based on a problem set originally published by Ken Train.</p>
<p>To ensure good preformance and ease of use, estimating parameters for a mixed logit model in Larch requires the <code class="docutils literal notranslate"><span class="pre">jax</span></code> library as the compute engine.  Importing it here allows us to confirm that it is available.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">jax</span>  <span class="c1"># noqa: F401</span>
</pre></div>
</div>
</div>
</div>
<p>The data represent consumers’ choices among vehicles in stated preference experiments. The data are from a study that he did for Toyota and GM to assist them in their analysis of the potential marketability of electric and hybrid vehicles, back before hybrids were introduced.</p>
<p>In each choice experiment, the respondent was presented with three vehicles, with the price and other attributes of each vehicle described. The respondent was asked to state which of the three vehicles he/she would buy if the these vehicles were the only ones available in the market. There are 100 respondents in our dataset (which, to reduce estimation time, is a subset of the full dataset which contains 500 respondents.) Each respondent was presented with 15 choice experiments, and most respondents answered all 15. The attributes of the vehicles were varied over experiments, both for a given respondent and over respondents. The attributes are: price, operating cost in dollars per month, engine type (gas, electric, or hybrid), range if electric (in hundreds of miles between recharging), and the performance level of the vehicle (high, medium, or low). The performance level was described in terms of top speed and acceleration, and these descriptions did not vary for each level; for example, “High” performance was described as having a top speed of 100 mpg and 12 seconds to reach 60 mpg, and this description was the same for all “high” performance vehicles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;data.txt&quot;</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;person_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;case_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;chosen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;price&quot;</span><span class="p">,</span>  <span class="c1"># dollars</span>
        <span class="s2">&quot;opcost&quot;</span><span class="p">,</span>  <span class="c1"># dollars per month</span>
        <span class="s2">&quot;max_range&quot;</span><span class="p">,</span>  <span class="c1"># hundreds of miles (0 if not electric)</span>
        <span class="s2">&quot;ev&quot;</span><span class="p">,</span>  <span class="c1"># bool</span>
        <span class="s2">&quot;gas&quot;</span><span class="p">,</span>  <span class="c1"># bool</span>
        <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span>  <span class="c1"># bool</span>
        <span class="s2">&quot;hiperf&quot;</span><span class="p">,</span>  <span class="c1"># High performance (bool)</span>
        <span class="s2">&quot;medhiperf&quot;</span><span class="p">,</span>  <span class="c1"># Medium or high performance (bool)</span>
    <span class="p">],</span>
    <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">raw_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>person_id</th>
      <th>case_id</th>
      <th>chosen</th>
      <th>price</th>
      <th>opcost</th>
      <th>max_range</th>
      <th>ev</th>
      <th>gas</th>
      <th>hybrid</th>
      <th>hiperf</th>
      <th>medhiperf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>46763</td>
      <td>47.43</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>57209</td>
      <td>27.43</td>
      <td>1.3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>87960</td>
      <td>32.41</td>
      <td>1.2</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>33768</td>
      <td>4.89</td>
      <td>1.3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>90336</td>
      <td>30.19</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4447</th>
      <td>100</td>
      <td>1483</td>
      <td>0</td>
      <td>28036</td>
      <td>14.45</td>
      <td>1.6</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4448</th>
      <td>100</td>
      <td>1483</td>
      <td>0</td>
      <td>19360</td>
      <td>54.76</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4449</th>
      <td>100</td>
      <td>1484</td>
      <td>1</td>
      <td>24054</td>
      <td>50.57</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4450</th>
      <td>100</td>
      <td>1484</td>
      <td>0</td>
      <td>52795</td>
      <td>21.25</td>
      <td>0.0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4451</th>
      <td>100</td>
      <td>1484</td>
      <td>0</td>
      <td>60705</td>
      <td>25.41</td>
      <td>1.4</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>4452 rows × 11 columns</p>
</div></div></div>
</div>
<p>Create <code class="docutils literal notranslate"><span class="pre">alt_id</span></code> values for each row within each group, and set
the index on case and alternative id’s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;alt_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;case_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cumcount</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;case_id&quot;</span><span class="p">,</span> <span class="s2">&quot;alt_id&quot;</span><span class="p">])</span>
<span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;price_scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10000</span>
<span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;opcost_scaled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s2">&quot;opcost&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">construct</span><span class="o">.</span><span class="n">from_idca</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="simple-mnl">
<h2>Simple MNL<a class="headerlink" href="#simple-mnl" title="Link to this heading">#</a></h2>
<p>Start with a simple MNL model, using all the variable in the dataset without transformations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">simple</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">simple</span><span class="o">.</span><span class="n">utility_ca</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">PX</span><span class="p">(</span><span class="s2">&quot;price_scaled&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">PX</span><span class="p">(</span><span class="s2">&quot;opcost_scaled&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">PX</span><span class="p">(</span><span class="s2">&quot;max_range&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">PX</span><span class="p">(</span><span class="s2">&quot;ev&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">PX</span><span class="p">(</span><span class="s2">&quot;hybrid&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">PX</span><span class="p">(</span><span class="s2">&quot;hiperf&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">PX</span><span class="p">(</span><span class="s2">&quot;medhiperf&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">simple</span><span class="o">.</span><span class="n">choice_ca_var</span> <span class="o">=</span> <span class="s2">&quot;chosen&quot;</span>
<span class="n">simple</span><span class="o">.</span><span class="n">maximize_loglike</span><span class="p">(</span><span class="n">stderr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ftol&quot;</span><span class="p">:</span> <span class="mf">1e-9</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">Larch Model Dashboard</span><span style="font-weight: bold">                                                                        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #008000; text-decoration-color: #008000">optimization complete</span>                                                                        │
│ Log Likelihood <span style="color: #808000; text-decoration-color: #808000">Current =      -1399.193115 </span><span style="color: #008000; text-decoration-color: #008000">Best =      -1399.193115</span>                          │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┓ │
│ ┃<span style="font-weight: bold"> Parameter                      </span>┃<span style="font-weight: bold"> Estimate       </span>┃<span style="font-weight: bold"> Std. Error     </span>┃<span style="font-weight: bold"> t-Stat     </span>┃<span style="font-weight: bold"> Null Val </span>┃ │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━┩ │
│ │ ev                             │ -1.3941457     │  0.27667809    │ -5.039     │  0       │ │
│ │ hiperf                         │  0.10999294    │  0.083826654   │  1.312     │  0       │ │
│ │ hybrid                         │  0.35535701    │  0.12181664    │  2.917     │  0       │ │
│ │ max_range                      │  0.47840485    │  0.17650166    │  2.71      │  0       │ │
│ │ medhiperf                      │  0.38431996    │  0.085456528   │  4.497     │  0       │ │
│ │ opcost_scaled                  │ -0.12876957    │  0.035309706   │ -3.647     │  0       │ │
│ │ price_scaled                   │ -0.4168321     │  0.033163231   │ -12.57     │  0       │ │
│ └────────────────────────────────┴────────────────┴────────────────┴────────────┴──────────┘ │
└──────────────────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div></div>
</div>
</section>
<section id="mixture-model">
<h2>Mixture Model<a class="headerlink" href="#mixture-model" title="Link to this heading">#</a></h2>
<p>To create a mixed logit model, we can start with a copy of the simple model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mixed</span> <span class="o">=</span> <span class="n">simple</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We assign mixtures to various parameters by providing a list of <code class="docutils literal notranslate"><span class="pre">Mixture</span></code> definitions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mixed</span><span class="o">.</span><span class="n">mixtures</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">lx</span><span class="o">.</span><span class="n">mixtures</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;s_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;opcost_scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;max_range&quot;</span><span class="p">,</span> <span class="s2">&quot;ev&quot;</span><span class="p">,</span> <span class="s2">&quot;hybrid&quot;</span><span class="p">,</span> <span class="s2">&quot;hiperf&quot;</span><span class="p">,</span> <span class="s2">&quot;medhiperf&quot;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The estimation of the mixed logit parameters sometimes performs
poorly (i.e. may prematurely call itself converged) if you start
from the MNL solution, so it can be advantageous to start from
the null parameters instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mixed</span><span class="o">.</span><span class="n">pvals</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>There are several extra settings that can be manipulated on the
mixed logit model, including the number of draws and a random seed
for generating draws.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mixed</span><span class="o">.</span><span class="n">n_draws</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">mixed</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mixed</span><span class="o">.</span><span class="n">maximize_loglike</span><span class="p">(</span><span class="n">stderr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ftol&quot;</span><span class="p">:</span> <span class="mf">1e-9</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">Larch Model Dashboard</span><span style="font-weight: bold">                                                                        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #008000; text-decoration-color: #008000">optimization complete</span>                                                                        │
│ Log Likelihood <span style="color: #808000; text-decoration-color: #808000">Current =      -1385.494385 </span><span style="color: #008000; text-decoration-color: #008000">Best =      -1385.494385</span>                          │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┓ │
│ ┃<span style="font-weight: bold"> Parameter                      </span>┃<span style="font-weight: bold"> Estimate       </span>┃<span style="font-weight: bold"> Std. Error     </span>┃<span style="font-weight: bold"> t-Stat     </span>┃<span style="font-weight: bold"> Null Val </span>┃ │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━┩ │
│ │ ev                             │ -3.0322464     │  0.7802586     │ -3.886     │  0       │ │
│ │ hiperf                         │  0.17636163    │  0.12485498    │  1.413     │  0       │ │
│ │ hybrid                         │  0.54640557    │  0.19363186    │  2.822     │  0       │ │
│ │ max_range                      │  0.88862361    │  0.32438633    │  2.739     │  0       │ │
│ │ medhiperf                      │  0.73259063    │  0.20890723    │  3.507     │  0       │ │
│ │ opcost_scaled                  │ -0.21991298    │  0.071609765   │ -3.071     │  0       │ │
│ │ price_scaled                   │ -0.64796439    │  0.10212141    │ -6.345     │  0       │ │
│ │ s_ev                           │ -2.8046057     │  0.75743836    │ -3.703     │  0       │ │
│ │ s_hiperf                       │ -0.52227201    │  0.8732264     │ -0.5981    │  0       │ │
│ │ s_hybrid                       │  1.1432043     │  0.66022414    │  1.732     │  0       │ │
│ │ s_max_range                    │ -0.13097281    │  0.99449962    │ -0.1317    │  0       │ │
│ │ s_medhiperf                    │  1.5749259     │  0.61276972    │  2.57      │  0       │ │
│ │ s_opcost_scaled                │  0.52076857    │  0.18559407    │  2.806     │  0       │ │
│ └────────────────────────────────┴────────────────┴────────────────┴────────────┴──────────┘ │
└──────────────────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-10-08 14:58:18.999651: E external/xla/xla/service/slow_operation_alarm.cc:65] Constant folding an instruction is taking &gt; 1s:

  %slice.67 = f32[1484,200,1]{2,1,0} slice(f32[1484,200,6]{2,1,0} %constant.426), slice={[0:1484], [0:200], [4:5]}, metadata={op_name=&quot;jit(func)/jit(main)/jvp(jit(func))/jit(func)/vmap(jit(func))/slice&quot; source_file=&quot;/tmp/ipykernel_4785/1105560992.py&quot; source_line=1}

This isn&#39;t necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you&#39;ll always be able to come up with an input program that takes a long time.

If you&#39;d like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
2024-10-08 14:58:19.001544: E external/xla/xla/service/slow_operation_alarm.cc:133] The operation took 1.001996036s
Constant folding an instruction is taking &gt; 1s:

  %slice.67 = f32[1484,200,1]{2,1,0} slice(f32[1484,200,6]{2,1,0} %constant.426), slice={[0:1484], [0:200], [4:5]}, metadata={op_name=&quot;jit(func)/jit(main)/jvp(jit(func))/jit(func)/vmap(jit(func))/slice&quot; source_file=&quot;/tmp/ipykernel_4785/1105560992.py&quot; source_line=1}

This isn&#39;t necessarily a bug; constant-folding is inherently a trade-off between compilation time and speed at runtime. XLA has some guards that attempt to keep constant folding from taking too long, but fundamentally you&#39;ll always be able to come up with an input program that takes a long time.

If you&#39;d like to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
</pre></div>
</div>
</div>
</div>
</section>
<section id="panel-data">
<h2>Panel Data<a class="headerlink" href="#panel-data" title="Link to this heading">#</a></h2>
<p>In the mixed logit model above, we have ignored the fact that
we have “panel data”, where multiple observations are made by the
same decision maker who (presumably) has stable preferences with
respect to the choice attributes.  We can tell Larch which data
column represents the panel identifiers in the <code class="docutils literal notranslate"><span class="pre">groupid</span></code> attribute,
(which we set to <code class="docutils literal notranslate"><span class="pre">&quot;person_id&quot;</span></code>) and then
use that information to build a significantly better model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">panel</span> <span class="o">=</span> <span class="n">mixed</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">panel</span><span class="o">.</span><span class="n">groupid</span> <span class="o">=</span> <span class="s2">&quot;person_id&quot;</span>
<span class="n">panel</span><span class="o">.</span><span class="n">maximize_loglike</span><span class="p">(</span><span class="n">stderr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ftol&quot;</span><span class="p">:</span> <span class="mf">1e-9</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">Larch Model Dashboard</span><span style="font-weight: bold">                                                                        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #008000; text-decoration-color: #008000">optimization complete</span>                                                                        │
│ Log Likelihood <span style="color: #808000; text-decoration-color: #808000">Current =      -1330.442871 </span><span style="color: #008000; text-decoration-color: #008000">Best =      -1330.442871</span>                          │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┓ │
│ ┃<span style="font-weight: bold"> Parameter                      </span>┃<span style="font-weight: bold"> Estimate       </span>┃<span style="font-weight: bold"> Std. Error     </span>┃<span style="font-weight: bold"> t-Stat     </span>┃<span style="font-weight: bold"> Null Val </span>┃ │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━┩ │
│ │ ev                             │ -1.7049911     │  0.34323138    │ -4.967     │  0       │ │
│ │ hiperf                         │  0.091747935   │  0.10427175    │  0.8799    │  0       │ │
│ │ hybrid                         │  0.46835346    │  0.16412829    │  2.854     │  0       │ │
│ │ max_range                      │  0.46331473    │  0.22783846    │  2.034     │  0       │ │
│ │ medhiperf                      │  0.50916671    │  0.11354999    │  4.484     │  0       │ │
│ │ opcost_scaled                  │ -0.13901338    │  0.052867349   │ -2.629     │  0       │ │
│ │ price_scaled                   │ -0.50152655    │  0.039682947   │ -12.64     │  0       │ │
│ │ s_ev                           │ -0.92261703    │  0.22150163    │ -4.165     │  0       │ │
│ │ s_hiperf                       │ -0.41947367    │  0.14358859    │ -2.921     │  0       │ │
│ │ s_hybrid                       │  0.84510815    │  0.13324448    │  6.343     │  0       │ │
│ │ s_max_range                    │  0.70988722    │  0.18730752    │  3.79      │  0       │ │
│ │ s_medhiperf                    │  0.60292887    │  0.14174812    │  4.254     │  0       │ │
│ │ s_opcost_scaled                │ -0.34689206    │  0.049323354   │ -7.033     │  0       │ │
│ └────────────────────────────────┴────────────────┴────────────────┴────────────┴──────────┘ │
└──────────────────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div></div>
</div>
<p>We can review summary statistics about the distibution of the mixed parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">panel</span><span class="o">.</span><span class="n">mixture_summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>share +</th>
      <th>share -</th>
      <th>share ø</th>
      <th>q25</th>
      <th>median</th>
      <th>q75</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ev</th>
      <td>-1.705006</td>
      <td>0.922245</td>
      <td>0.03225</td>
      <td>0.96775</td>
      <td>0.0</td>
      <td>-2.327112</td>
      <td>-1.705043</td>
      <td>-1.082771</td>
    </tr>
    <tr>
      <th>hiperf</th>
      <td>0.091802</td>
      <td>0.419670</td>
      <td>0.58640</td>
      <td>0.41360</td>
      <td>0.0</td>
      <td>-0.191174</td>
      <td>0.091737</td>
      <td>0.374545</td>
    </tr>
    <tr>
      <th>hybrid</th>
      <td>0.468473</td>
      <td>0.846144</td>
      <td>0.71005</td>
      <td>0.28995</td>
      <td>0.0</td>
      <td>-0.101565</td>
      <td>0.468299</td>
      <td>1.038188</td>
    </tr>
    <tr>
      <th>max_range</th>
      <td>0.463403</td>
      <td>0.710176</td>
      <td>0.74290</td>
      <td>0.25710</td>
      <td>0.0</td>
      <td>-0.015535</td>
      <td>0.463319</td>
      <td>0.942104</td>
    </tr>
    <tr>
      <th>medhiperf</th>
      <td>0.509205</td>
      <td>0.603204</td>
      <td>0.80070</td>
      <td>0.19930</td>
      <td>0.0</td>
      <td>0.102603</td>
      <td>0.509239</td>
      <td>0.915816</td>
    </tr>
    <tr>
      <th>opcost_scaled</th>
      <td>-0.138985</td>
      <td>0.346830</td>
      <td>0.34410</td>
      <td>0.65590</td>
      <td>0.0</td>
      <td>-0.372994</td>
      <td>-0.138974</td>
      <td>0.094954</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The “share” columns show the share of random simulations with positive, negative, or
zero values for each model parameter. This summary shows that about a third of people
show a positive parameter on operating costs, i.e. they prefer higher costs.  That’s
probably not reasonable.</p>
</section>
<section id="log-normal-parameter">
<h2>Log-Normal Parameter<a class="headerlink" href="#log-normal-parameter" title="Link to this heading">#</a></h2>
<p>Let’s change the operating cost parameter to have a negative log-normal distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">panel2</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">panel2</span><span class="o">.</span><span class="n">mixtures</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">mixtures</span><span class="o">.</span><span class="n">NegLogNormal</span><span class="p">(</span><span class="s2">&quot;opcost_scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;s_opcost_scaled&quot;</span><span class="p">)</span>
<span class="n">panel2</span><span class="o">.</span><span class="n">pvals</span> <span class="o">=</span> <span class="s2">&quot;null&quot;</span>
<span class="n">panel2</span><span class="o">.</span><span class="n">maximize_loglike</span><span class="p">(</span><span class="n">stderr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ftol&quot;</span><span class="p">:</span> <span class="mf">1e-9</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> </span><span style="color: #000080; text-decoration-color: #000080; font-weight: bold">Larch Model Dashboard</span><span style="font-weight: bold">                                                                        </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ <span style="color: #008000; text-decoration-color: #008000">optimization complete</span>                                                                        │
│ Log Likelihood <span style="color: #808000; text-decoration-color: #808000">Current =      -1333.023193 </span><span style="color: #008000; text-decoration-color: #008000">Best =      -1333.023193</span>                          │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━┓ │
│ ┃<span style="font-weight: bold"> Parameter                      </span>┃<span style="font-weight: bold"> Estimate       </span>┃<span style="font-weight: bold"> Std. Error     </span>┃<span style="font-weight: bold"> t-Stat     </span>┃<span style="font-weight: bold"> Null Val </span>┃ │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━┩ │
│ │ ev                             │ -1.7643582     │  0.34406516    │ -5.128     │  0       │ │
│ │ hiperf                         │  0.075660229   │  0.10362975    │  0.7301    │  0       │ │
│ │ hybrid                         │  0.39115657    │  0.1539721     │  2.54      │  0       │ │
│ │ max_range                      │  0.51450253    │  0.21839832    │  2.356     │  0       │ │
│ │ medhiperf                      │  0.51144322    │  0.11600209    │  4.409     │  0       │ │
│ │ opcost_scaled                  │ -2.7770728     │  0.53787482    │ -5.163     │  0       │ │
│ │ price_scaled                   │ -0.48363872    │  0.038662639   │ -12.51     │  0       │ │
│ │ s_ev                           │ -1.032371      │  0.25945407    │ -3.979     │  0       │ │
│ │ s_hiperf                       │ -0.39722811    │  0.13086499    │ -3.035     │  0       │ │
│ │ s_hybrid                       │  0.84509614    │  0.13246694    │  6.38      │  0       │ │
│ │ s_max_range                    │ -0.4789817     │  0.17029601    │ -2.813     │  0       │ │
│ │ s_medhiperf                    │ -0.652664      │  0.14292786    │ -4.566     │  0       │ │
│ │ s_opcost_scaled                │  1.6935438     │  0.299436      │  5.656     │  0       │ │
│ └────────────────────────────────┴────────────────┴────────────────┴────────────┴──────────┘ │
└──────────────────────────────────────────────────────────────────────────────────────────────┘
</pre>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">panel2</span><span class="o">.</span><span class="n">mixture_summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>share +</th>
      <th>share -</th>
      <th>share ø</th>
      <th>q25</th>
      <th>median</th>
      <th>q75</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ev</th>
      <td>-1.764376</td>
      <td>1.031955</td>
      <td>0.04410</td>
      <td>0.95590</td>
      <td>0.0</td>
      <td>-2.460486</td>
      <td>-1.764416</td>
      <td>-1.068119</td>
    </tr>
    <tr>
      <th>hiperf</th>
      <td>0.075711</td>
      <td>0.397414</td>
      <td>0.57545</td>
      <td>0.42455</td>
      <td>0.0</td>
      <td>-0.192258</td>
      <td>0.075650</td>
      <td>0.343460</td>
    </tr>
    <tr>
      <th>hybrid</th>
      <td>0.391276</td>
      <td>0.846132</td>
      <td>0.67820</td>
      <td>0.32180</td>
      <td>0.0</td>
      <td>-0.178753</td>
      <td>0.391102</td>
      <td>0.960983</td>
    </tr>
    <tr>
      <th>max_range</th>
      <td>0.514443</td>
      <td>0.479176</td>
      <td>0.85840</td>
      <td>0.14160</td>
      <td>0.0</td>
      <td>0.191449</td>
      <td>0.514499</td>
      <td>0.837596</td>
    </tr>
    <tr>
      <th>medhiperf</th>
      <td>0.511402</td>
      <td>0.652961</td>
      <td>0.78335</td>
      <td>0.21665</td>
      <td>0.0</td>
      <td>0.071250</td>
      <td>0.511365</td>
      <td>0.951545</td>
    </tr>
    <tr>
      <th>opcost_scaled</th>
      <td>-0.259726</td>
      <td>0.992681</td>
      <td>0.00000</td>
      <td>1.00000</td>
      <td>0.0</td>
      <td>-0.194998</td>
      <td>-0.062208</td>
      <td>-0.019855</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">panel2</span><span class="o">.</span><span class="n">mixture_density</span><span class="p">(</span><span class="s2">&quot;opcost_scaled&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3288f84a866cb51725ccbabb51192f772057c6a0ea9b8a6ec4914fe642c75ffe.png" src="../../_images/3288f84a866cb51725ccbabb51192f772057c6a0ea9b8a6ec4914fe642c75ffe.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">panel2</span><span class="o">.</span><span class="n">mixture_density</span><span class="p">(</span><span class="s2">&quot;hybrid&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/78420a193b68f77ad9e68eebd06f9ed6c135728aa9904e99d37bf6003ee16ca3.png" src="../../_images/78420a193b68f77ad9e68eebd06f9ed6c135728aa9904e99d37bf6003ee16ca3.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Vehicle Choice Examples</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-mnl">Simple MNL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mixture-model">Mixture Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#panel-data">Panel Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#log-normal-parameter">Log-Normal Parameter</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/examples/vehicle/300_veh_type.ipynb">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item"><!-- This will display the version of the docs -->
<p class="larch-version">🌳 Larch v6.0.26.dev2+g135c0b8, © Copyright 2024.</p></div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>